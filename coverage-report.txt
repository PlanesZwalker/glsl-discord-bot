
> shaderbot@2.1.0 test
> jest --coverage --coverageReporters=text --silent

npm : (node:23588) [DEP0147] DeprecationWarning: In future versions of Node.js, fs.rmdir(path, { recursive: true }) 
will be removed. Use fs.rm(path, { recursive: true }) instead
Au caractère C:\Users\anne\AppData\Local\Temp\ps-script-b4c865dc-45d4-4bb7-9048-15bd28e3efcc.ps1:121 : 1
+ npm test -- --coverage --coverageReporters=text --silent 2>&1 | Out-F ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: ((node:23588) [D...true }) instead:String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
(Use `node --trace-deprecation ...` to show where the warning was created)
FAIL tests/simple-database.test.js
  SimpleDatabase
    initialize
      ├ù devrait initialiser la base de donn├®es en local (9 ms)
      ├ù devrait utiliser la m├®moire sur Vercel (1 ms)
      ├ù devrait cr├®er le dossier data s'il n'existe pas (1 ms)
      ├ù devrait utiliser la m├®moire en cas d'erreur de cr├®ation de dossier (1 ms)
    saveShader
      ÔêÜ devrait sauvegarder un shader (2 ms)
      ÔêÜ devrait rejeter si non initialis├® (4 ms)
    getShaderById
      ÔêÜ devrait r├®cup├®rer un shader par ID (1 ms)
      ÔêÜ devrait retourner null si shader non trouv├® (1 ms)
      ÔêÜ devrait rejeter si non initialis├® (1 ms)
      ÔêÜ devrait r├®cup├®rer un shader par ID
      ÔêÜ devrait retourner null si shader non trouv├® (1 ms)
    getShadersByUserId
      ÔêÜ devrait r├®cup├®rer les shaders d'un utilisateur (1 ms)
      ÔêÜ devrait r├®cup├®rer les shaders d'un utilisateur (1 ms)
    updateUserStats
      ÔêÜ devrait mettre ├á jour les stats d'un utilisateur (1 ms)
    getStats
      ÔêÜ devrait retourner les statistiques (1 ms)
      ÔêÜ devrait g├®rer les erreurs dans getStats (1 ms)
    close
      ÔêÜ devrait fermer la base de donn├®es (2 ms)
      ÔêÜ devrait g├®rer la base d├®j├á ferm├®e (1 ms)
      ÔêÜ devrait g├®rer si db est null
    getShaderByName
      ÔêÜ devrait r├®cup├®rer un shader par nom
    searchShadersByName
      ÔêÜ devrait rechercher des shaders par nom (1 ms)
    incrementViews
      ÔêÜ devrait incr├®menter les vues (1 ms)
    getPopularShaders
      ÔêÜ devrait r├®cup├®rer les shaders populaires
    searchShaders
      ÔêÜ devrait rechercher des shaders
    getUserShaderCount
      ÔêÜ devrait compter les shaders d'un utilisateur
    getUserShadersPaginated
      ÔêÜ devrait r├®cup├®rer les shaders pagin├®s (1 ms)
    createIndexes
      ÔêÜ devrait cr├®er les index
      ÔêÜ devrait g├®rer les erreurs de cr├®ation d'index (1 ms)
    saveShader error handling
      ÔêÜ devrait g├®rer les erreurs lors de la sauvegarde (1 ms)
      ÔêÜ devrait g├®rer les valeurs null pour imagePath et gifPath
    getShaderById error handling
      ÔêÜ devrait g├®rer les erreurs de base de donn├®es (1 ms)
    getShaderByName error handling
      ÔêÜ devrait g├®rer les erreurs de base de donn├®es (1 ms)
      ÔêÜ devrait retourner null si shader non trouv├®
    searchShadersByName error handling
      ÔêÜ devrait g├®rer les erreurs de base de donn├®es (1 ms)
      ÔêÜ devrait retourner un tableau vide si aucun r├®sultat
    incrementViews error handling
      ÔêÜ devrait g├®rer les erreurs lors de l'incr├®mentation (1 ms)
    getPopularShaders error handling
      ÔêÜ devrait g├®rer les erreurs de base de donn├®es (4 ms)
      ÔêÜ devrait retourner un tableau vide si aucun r├®sultat (1 ms)
    searchShaders error handling
      ÔêÜ devrait g├®rer les erreurs de base de donn├®es
      ÔêÜ devrait retourner un tableau vide si aucun r├®sultat (1 ms)
    getShadersByUserId error handling
      ÔêÜ devrait g├®rer les erreurs de base de donn├®es
      ÔêÜ devrait retourner un tableau vide si aucun shader (1 ms)
    getUserShaderCount error handling
      ÔêÜ devrait g├®rer les erreurs de base de donn├®es
      ÔêÜ devrait retourner 0 si aucun shader (1 ms)
      ÔêÜ devrait retourner 0 si row est null
    getUserShadersPaginated error handling
      ÔêÜ devrait g├®rer les erreurs de base de donn├®es (1 ms)
      ├ù devrait utiliser les valeurs par d├®faut pour page et limit (3 ms)
    updateUserStats error handling
      ÔêÜ devrait g├®rer les erreurs lors de la mise ├á jour (1 ms)
    close error handling
      ÔêÜ devrait g├®rer les erreurs lors de la fermeture
      ÔêÜ devrait g├®rer les exceptions lors de la v├®rification
    enableWAL
      ÔêÜ devrait activer WAL mode (1 ms)
      ÔêÜ devrait g├®rer les erreurs lors de l'activation de WAL

  ÔùÅ SimpleDatabase ÔÇ║ initialize ÔÇ║ devrait initialiser la base de donn├®es en local

    TypeError: this.db.run is not a function

      103 |
      104 |             // Ex├®cuter les deux instructions s├®par├®ment
    > 105 |             this.db.run(createShadersTable, (err) => {
          |                     ^
      106 |                 if (err) {
      107 |                     console.error('ÔØî Erreur cr├®ation table shaders:', err);
      108 |                     reject(err);

      at run (src/simple-database.js:105:21)
      at SimpleDatabase.createTables (src/simple-database.js:77:16)
      at SimpleDatabase.createTables [as initialize] (src/simple-database.js:66:28)
      at Object.<anonymous> (tests/simple-database.test.js:139:13)

  ÔùÅ SimpleDatabase ÔÇ║ initialize ÔÇ║ devrait utiliser la m├®moire sur Vercel

    TypeError: this.db.run is not a function

      103 |
      104 |             // Ex├®cuter les deux instructions s├®par├®ment
    > 105 |             this.db.run(createShadersTable, (err) => {
          |                     ^
      106 |                 if (err) {
      107 |                     console.error('ÔØî Erreur cr├®ation table shaders:', err);
      108 |                     reject(err);

      at run (src/simple-database.js:105:21)
      at SimpleDatabase.createTables (src/simple-database.js:77:16)
      at SimpleDatabase.createTables [as initialize] (src/simple-database.js:66:28)
      at Object.<anonymous> (tests/simple-database.test.js:193:13)

  ÔùÅ SimpleDatabase ÔÇ║ initialize ÔÇ║ devrait cr├®er le dossier data s'il n'existe pas

    TypeError: this.db.run is not a function

      103 |
      104 |             // Ex├®cuter les deux instructions s├®par├®ment
    > 105 |             this.db.run(createShadersTable, (err) => {
          |                     ^
      106 |                 if (err) {
      107 |                     console.error('ÔØî Erreur cr├®ation table shaders:', err);
      108 |                     reject(err);

      at run (src/simple-database.js:105:21)
      at SimpleDatabase.createTables (src/simple-database.js:77:16)
      at SimpleDatabase.createTables [as initialize] (src/simple-database.js:66:28)
      at Object.<anonymous> (tests/simple-database.test.js:248:13)

  ÔùÅ SimpleDatabase ÔÇ║ initialize ÔÇ║ devrait utiliser la m├®moire en cas d'erreur de cr├®ation de dossier

    TypeError: this.db.run is not a function

      103 |
      104 |             // Ex├®cuter les deux instructions s├®par├®ment
    > 105 |             this.db.run(createShadersTable, (err) => {
          |                     ^
      106 |                 if (err) {
      107 |                     console.error('ÔØî Erreur cr├®ation table shaders:', err);
      108 |                     reject(err);

      at run (src/simple-database.js:105:21)
      at SimpleDatabase.createTables (src/simple-database.js:77:16)
      at SimpleDatabase.createTables [as initialize] (src/simple-database.js:66:28)
      at Object.<anonymous> (tests/simple-database.test.js:306:13)

  ÔùÅ SimpleDatabase ÔÇ║ getUserShadersPaginated error handling ÔÇ║ devrait utiliser les valeurs par d├®faut pour page 
et limit

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "LIMIT", ArrayContaining [20, 0]
    Received: "SELECT * FROM shaders WHERE user_id = ? ORDER BY created_at DESC LIMIT ? OFFSET ?", ["user123", 20, 0], 
[Function anonymous]

    Number of calls: 1

       999 |             expect(results).toEqual([]);
      1000 |             // V├®rifier que les valeurs par d├®faut sont utilis├®es (page=1, limit=20)
    > 1001 |             expect(mockDb.all).toHaveBeenCalledWith(
           |                                ^
      1002 |                 expect.stringContaining('LIMIT'),
      1003 |                 expect.arrayContaining([20, 0]) // limit=20, offset=0
      1004 |             );

      at Object.toHaveBeenCalledWith (tests/simple-database.test.js:1001:32)

PASS tests/commands/shader-preset.test.js
  shader-preset command
    ÔêÜ devrait avoir la structure de commande correcte (7 ms)
    ÔêÜ devrait ex├®cuter autocomplete (1 ms)
    ÔêÜ devrait compiler un preset avec succ├¿s (2 ms)
    ÔêÜ devrait rejeter si rate limit d├®pass├® (1 ms)
    ÔêÜ devrait rejeter si preset non trouv├® (1 ms)
    ÔêÜ devrait rejeter si validation ├®choue
    ÔêÜ devrait g├®rer les erreurs de compilation (1 ms)
    ÔêÜ devrait utiliser le GIF si disponible (1 ms)
    ÔêÜ devrait utiliser frameDirectory en fallback si pas de GIF (1 ms)
    ÔêÜ devrait g├®rer les erreurs (1 ms)
    ÔêÜ devrait inclure presetName dans le r├®sultat

PASS tests/utils/cacheManager.test.js
  CacheManager
    generateKey
      ÔêÜ devrait g├®n├®rer une cl├® de cache (2 ms)
      ÔêÜ devrait g├®n├®rer la m├¬me cl├® pour les m├¬mes donn├®es
    get/set
      ÔêÜ devrait stocker et r├®cup├®rer une valeur (1 ms)
      ÔêÜ devrait retourner null pour une cl├® inexistante (1 ms)
      ÔêÜ devrait expirer les valeurs apr├¿s TTL (25 ms)
    delete
      ÔêÜ devrait supprimer une cl├®
      ÔêÜ devrait g├®rer les erreurs lors de la suppression (1 ms)
    invalidate
      ÔêÜ devrait invalider les cl├®s correspondant au pattern (1 ms)
      ÔêÜ devrait g├®rer les erreurs lors de l'invalidation
      ÔêÜ devrait g├®rer les patterns sans correspondance
    cleanExpired
      ÔêÜ devrait nettoyer les entr├®es expir├®es (14 ms)
      ÔêÜ devrait retourner 0 si aucune entr├®e expir├®e
      ÔêÜ devrait nettoyer plusieurs entr├®es expir├®es (13 ms)
    getStats
      ÔêÜ devrait retourner les statistiques (1 ms)
      ÔêÜ devrait calculer le hitRate correctement (1 ms)
      ÔêÜ devrait g├®rer le cas o├╣ il n'y a pas de requ├¬tes
    resetStats
      ÔêÜ devrait r├®initialiser les statistiques
    getCacheManager singleton
      ÔêÜ devrait retourner la m├¬me instance
    Redis integration
      ÔêÜ devrait utiliser Redis si configur├® (4 ms)
      ÔêÜ devrait g├®rer les erreurs Redis (1 ms)
    set
      ÔêÜ devrait g├®rer les erreurs lors de la sauvegarde
      ÔêÜ devrait g├®rer les valeurs expir├®es dans le cache m├®moire (25 ms)
    memory cache limits
      ÔêÜ devrait g├®rer le cache m├®moire plein (1 ms)

Le chemin d'acc´┐¢s sp´┐¢cifi´┐¢ est introuvable.
Le chemin d'acc´┐¢s sp´┐¢cifi´┐¢ est introuvable.
(node:7132) [DEP0147] DeprecationWarning: In future versions of Node.js, fs.rmdir(path, { recursive: true }) will be 
removed. Use fs.rm(path, { recursive: true }) instead
(Use `node --trace-deprecation ...` to show where the warning was created)
PASS tests/utils/circuitBreaker.test.js
  CircuitBreaker
    execute
      ÔêÜ devrait ex├®cuter une fonction avec succ├¿s en ├®tat CLOSED (2 ms)
      ÔêÜ devrait passer en OPEN apr├¿s plusieurs ├®checs (1 ms)
      ÔêÜ devrait rejeter imm├®diatement en ├®tat OPEN (16 ms)
      ÔêÜ devrait passer en HALF_OPEN apr├¿s le timeout (1 ms)
      ÔêÜ devrait passer les arguments ├á la fonction
    onSuccess
      ÔêÜ devrait r├®initialiser les ├®checs (1 ms)
      ÔêÜ devrait fermer le circuit en HALF_OPEN
    onFailure
      ÔêÜ devrait incr├®menter les ├®checs (1 ms)
      ÔêÜ devrait ouvrir le circuit apr├¿s le seuil (1 ms)
      ÔêÜ devrait d├®finir nextAttempt lors de l'ouverture (1 ms)
    getState
      ÔêÜ devrait retourner l'├®tat actuel (1 ms)
      ÔêÜ devrait inclure nextAttempt si OPEN (1 ms)
      ÔêÜ devrait retourner null pour nextAttempt si pas OPEN
    reset
      ÔêÜ devrait r├®initialiser le circuit breaker (1 ms)
    Configuration par d├®faut
      ÔêÜ devrait utiliser les valeurs par d├®faut (1 ms)

PASS tests/template-syntax.test.js
  Template HTML Syntax Tests
    WebGL Security Injection
      ÔêÜ injectSecurityLimits() devrait retourner du code JavaScript valide (9 ms)
      ÔêÜ Le code de s├®curit├® devrait pouvoir ├¬tre ├®valu├® sans erreur
    Template HTML Generation
      Ôùï skipped createCompilationPage devrait g├®n├®rer un template HTML valide
    Template Literal Conflicts
      ÔêÜ Le template HTML ne devrait pas avoir de conflits de template literals (1 ms)

PASS tests/compiler.test.js
  RealWebGLCompiler
    D├®tection du format shader
      ÔêÜ devrait d├®tecter GLSL (9 ms)
      ÔêÜ devrait d├®tecter WGSL (1 ms)
      ÔêÜ devrait d├®tecter GLSL avec uniform
      ÔêÜ devrait d├®tecter GLSL avec vec2
      ÔêÜ devrait d├®tecter WGSL avec @vertex
      ÔêÜ devrait d├®tecter WGSL avec texture_
      ÔêÜ devrait pr├®f├®rer WGSL si plus de keywords WGSL sont d├®tect├®s (1 ms)
      ÔêÜ devrait pr├®f├®rer GLSL si plus de keywords GLSL sont d├®tect├®s
      ÔêÜ devrait retourner glsl par d├®faut si aucun format n'est d├®tect├®
    Validation des shaders
      ÔêÜ devrait valider un shader GLSL valide
      ÔêÜ devrait rejeter un shader GLSL invalide (1 ms)
      ÔêÜ devrait rejeter un shader trop long (1 ms)
      ÔêÜ devrait valider un shader vide (pas d'erreur de validation) (1 ms)
      ÔêÜ devrait valider un shader WGSL valide
      ÔêÜ devrait d├®tecter les shaders avec des fonctions mainImage manquantes (GLSL)
    Cache
      Ôùï skipped devrait utiliser le cache pour les shaders identiques
    setupOutputDirectory
      ÔêÜ devrait cr├®er le dossier output si pas sur Vercel (4 ms)
      ÔêÜ ne devrait pas cr├®er le dossier sur Vercel (1 ms)
    Error handling
      ÔêÜ devrait g├®rer les erreurs lors de la validation
      ÔêÜ devrait g├®rer les erreurs lors de la d├®tection de format

PASS tests/utils/telemetry.test.js
  Telemetry
    startSpan
      ÔêÜ devrait d├®marrer un span (2 ms)
      ÔêÜ devrait accepter des m├®tadonn├®es (1 ms)
    endSpan
      ÔêÜ devrait terminer un span et enregistrer les m├®triques
      ÔêÜ devrait g├®rer les erreurs
      ÔêÜ ne devrait rien faire si le span n'existe pas (1 ms)
      ÔêÜ devrait supprimer le span apr├¿s la fin
    getMetricType
      ÔêÜ devrait identifier les compilations (1 ms)
      ÔêÜ devrait identifier les appels API
      ÔêÜ devrait identifier les requ├¬tes DB
    getThreshold
      ÔêÜ devrait retourner le seuil pour une op├®ration (1 ms)
      ÔêÜ devrait retourner le seuil par d├®faut
    getReport
      ÔêÜ devrait g├®n├®rer un rapport (27 ms)
      ÔêÜ devrait filtrer par fen├¬tre temporelle (14 ms)
    summarize
      ÔêÜ devrait r├®sumer les m├®triques (1 ms)
      ÔêÜ devrait retourner des z├®ros pour une liste vide
    avg
      ÔêÜ devrait calculer la moyenne (1 ms)
    percentile
      ÔêÜ devrait calculer les percentiles
    getRawMetrics
      ÔêÜ devrait retourner les m├®triques brutes (1 ms)
    reset
      ÔêÜ devrait r├®initialiser les m├®triques
    endSpan - slow operations
      ÔêÜ devrait alerter pour les op├®rations lentes (1 ms)
    endSpan - maxMetrics limit
      ÔêÜ devrait limiter la taille des m├®triques
    getMetricType - edge cases
      ÔêÜ devrait retourner compilations par d├®faut
    getThreshold - partial matches
      ÔêÜ devrait trouver le seuil par correspondance partielle
    percentile - edge cases
      ÔêÜ devrait g├®rer un tableau vide
      ÔêÜ devrait g├®rer un tableau avec un seul ├®l├®ment (1 ms)
      ÔêÜ devrait calculer correctement les percentiles pour diff├®rents p
    summarize - edge cases
      ÔêÜ devrait g├®rer les m├®triques avec diff├®rentes dur├®es (1 ms)
    getReport - different metric types
      ÔêÜ devrait inclure tous les types de m├®triques
    constructor options
      ÔêÜ devrait accepter des options personnalis├®es
    getTelemetry singleton
      ÔêÜ devrait retourner la m├¬me instance
      ÔêÜ devrait accepter des options ├á la premi├¿re cr├®ation (4 ms)

PASS tests/browser-pool.test.js
  BrowserPool
    constructor
      ÔêÜ devrait cr├®er un pool avec maxInstances (1 ms)
      ÔêÜ devrait utiliser 2 instances par d├®faut
    initialize
      ÔêÜ devrait initialiser le pool (1 ms)
      ÔêÜ ne devrait pas r├®initialiser si d├®j├á initialis├®
    findChromePath
      ÔêÜ devrait trouver Chrome dans le cache (1 ms)
      ÔêÜ devrait retourner null si Chrome non trouv├®
    getBrowser
      ÔêÜ devrait r├®utiliser un browser du pool
      ÔêÜ devrait cr├®er un nouveau browser si le pool est vide (1 ms)
      ÔêÜ devrait attendre si maxInstances atteint (14 ms)
      ÔêÜ devrait cr├®er un nouveau browser si celui du pool est ferm├® (1 ms)
    releaseBrowser
      ÔêÜ devrait remettre le browser dans le pool
      ÔêÜ devrait fermer le browser si le pool est plein (1 ms)
      ÔêÜ devrait fermer le browser s'il n'est plus connect├®
      ÔêÜ ne devrait rien faire si browser est null (1 ms)
    closeAll
      ÔêÜ devrait fermer tous les browsers du pool (1 ms)
    getStats
      ÔêÜ devrait retourner les statistiques du pool (1 ms)
    getBrowserPool singleton
      ÔêÜ devrait retourner la m├¬me instance (1 ms)

PASS tests/metrics.test.js
  Metrics
    recordCompilation
      ÔêÜ devrait enregistrer une compilation r├®ussie (3 ms)
      ÔêÜ devrait enregistrer une compilation ├®chou├®e (1 ms)
      ÔêÜ devrait enregistrer le temps de compilation (1 ms)
      ÔêÜ devrait limiter l'historique ├á maxHistorySize (2 ms)
      ÔêÜ devrait enregistrer les statistiques par type de shader
      ÔêÜ devrait enregistrer les statistiques par utilisateur
      ÔêÜ devrait accumuler les statistiques par type (1 ms)
    recordError
      ÔêÜ devrait enregistrer une erreur (11 ms)
      ÔêÜ devrait limiter le nombre d'erreurs (31 ms)
      ÔêÜ devrait inclure le contexte (1 ms)
    startCompilation/endCompilation
      ÔêÜ devrait incr├®menter les compilations actives
      ÔêÜ devrait d├®cr├®menter les compilations actives (1 ms)
      ÔêÜ ne devrait pas aller en dessous de 0
    getAverageCompilationTime
      ÔêÜ devrait retourner 0 si aucune compilation
      ÔêÜ devrait calculer la moyenne (1 ms)
    getSuccessRate
      ÔêÜ devrait retourner 0 si aucune compilation
      ÔêÜ devrait calculer le taux de succ├¿s
    getStats
      ÔêÜ devrait retourner les statistiques compl├¿tes (2 ms)
      ÔêÜ devrait inclure les top utilisateurs
    reset
      ÔêÜ devrait r├®initialiser toutes les m├®triques (1 ms)
    getMetrics singleton
      ÔêÜ devrait retourner la m├¬me instance

PASS tests/utils/progressTracker.test.js
  ProgressTracker
    startTracking
      ÔêÜ devrait d├®marrer le suivi d'un job (2 ms)
      ÔêÜ devrait initialiser avec les m├®tadonn├®es
      ÔêÜ devrait d├®finir startTime
    updateProgress
      ÔêÜ devrait mettre ├á jour la progression
      ÔêÜ devrait limiter la progression entre 0 et 100
      ÔêÜ devrait pr├®server le step pr├®c├®dent si non fourni
      ÔêÜ ne devrait rien faire si le job n'existe pas (1 ms)
      ÔêÜ devrait mettre ├á jour lastUpdate
    complete
      ÔêÜ devrait marquer un job comme termin├® (1 ms)
      ÔêÜ devrait calculer la dur├®e (19 ms)
      ÔêÜ devrait d├®finir endTime
      ÔêÜ ne devrait rien faire si le job n'existe pas
    fail
      ÔêÜ devrait marquer un job comme ├®chou├® (1 ms)
      ÔêÜ devrait g├®rer les erreurs sans message
      ÔêÜ devrait calculer la dur├®e (14 ms)
      ÔêÜ ne devrait rien faire si le job n'existe pas
    getProgress
      ÔêÜ devrait retourner la progression d'un job
      ÔêÜ devrait retourner null pour un job inexistant (1 ms)
    remove
      ÔêÜ devrait supprimer le suivi d'un job
      ÔêÜ ne devrait rien faire si le job n'existe pas
    cleanOldJobs
      ÔêÜ devrait nettoyer les anciens jobs
      ÔêÜ ne devrait pas nettoyer les jobs r├®cents (1 ms)
      ÔêÜ ne devrait pas nettoyer les jobs sans endTime
    getActiveJobs
      ÔêÜ devrait retourner les jobs actifs
      ÔêÜ devrait inclure les jobs en processing
      ÔêÜ devrait retourner un tableau vide si aucun job actif (1 ms)
    getProgressTracker singleton
      ÔêÜ devrait retourner la m├¬me instance

PASS tests/utils/webhookManager.test.js
  WebhookManager
    sendError
      ÔêÜ devrait envoyer une erreur via webhook (15 ms)
      ÔêÜ devrait inclure le contexte (1 ms)
      ÔêÜ ne devrait rien faire si webhook non configur├® (1 ms)
    sendCompilationStats
      ÔêÜ devrait envoyer les statistiques
      ÔêÜ ne devrait rien faire si webhook non configur├® (1 ms)
    sendAnalytics
      ÔêÜ devrait envoyer les analytics
    send
      ÔêÜ devrait envoyer un message personnalis├® (1 ms)
      ÔêÜ ne devrait rien faire si URL vide
    isEnabled
      ÔêÜ devrait retourner true si webhooks configur├®s
      ÔêÜ devrait retourner false si aucun webhook configur├®
    sendError - edge cases
      ÔêÜ devrait tronquer les stack traces longues (1 ms)
      ÔêÜ devrait g├®rer les erreurs sans stack trace
      ÔêÜ devrait tronquer le contexte long (1 ms)
      ÔêÜ devrait g├®rer les erreurs lors de l'envoi (2 ms)
    sendCompilationStats - edge cases
      ÔêÜ devrait g├®rer les stats avec valeurs manquantes
      ÔêÜ devrait g├®rer les erreurs lors de l'envoi (1 ms)
    sendAnalytics - edge cases
      ÔêÜ devrait g├®rer les analytics avec valeurs manquantes
      ÔêÜ devrait g├®rer les erreurs lors de l'envoi (1 ms)
    send - error handling
      ÔêÜ devrait g├®rer les r├®ponses non-OK (4 ms)
      ÔêÜ devrait g├®rer les erreurs r├®seau (1 ms)
    constructor - enabled state
      ÔêÜ devrait ├¬tre d├®sactiv├® si aucun webhook configur├®
      ÔêÜ devrait ├¬tre activ├® si au moins un webhook configur├®
    getWebhookManager singleton
      ÔêÜ devrait retourner la m├¬me instance

PASS tests/utils/backupManager.test.js
  BackupManager
    ensureBackupDir
      ÔêÜ devrait cr├®er le r├®pertoire de backup (10 ms)
      ÔêÜ devrait g├®rer les erreurs de cr├®ation de r├®pertoire (14 ms)
    createDatabaseBackup
      ÔêÜ devrait cr├®er un backup de la base de donn├®es (7 ms)
      ÔêÜ devrait g├®rer les erreurs de copie de fichier (2 ms)
    exportMetrics
      ÔêÜ devrait exporter les m├®triques (4 ms)
      ÔêÜ devrait inclure les m├®triques de d├®pendances (5 ms)
      ÔêÜ devrait g├®rer les erreurs de d├®pendances (5 ms)
      ÔêÜ devrait g├®rer les erreurs d'├®criture de fichier (2 ms)
    cleanOldBackups
      ÔêÜ devrait nettoyer les vieux backups (168 ms)
      ÔêÜ devrait g├®rer les erreurs de lecture de r├®pertoire (1 ms)
      ÔêÜ devrait g├®rer les erreurs de stat (29 ms)
    createFullBackup
      ÔêÜ devrait cr├®er un backup complet (7 ms)
      ÔêÜ devrait g├®rer l'absence de fichier DB (8 ms)
      ÔêÜ devrait g├®rer les erreurs g├®n├®rales (1 ms)
    getBackupManager singleton
      ÔêÜ devrait retourner la m├¬me instance (1 ms)
    setupS3
      ÔêÜ devrait configurer S3 si les credentials sont disponibles (470 ms)
      ÔêÜ devrait g├®rer l'absence de credentials S3 (1 ms)
    uploadToS3
      ÔêÜ devrait retourner silencieusement si S3 n'est pas configur├® (1 ms)
      ÔêÜ devrait g├®rer les erreurs S3 sans faire ├®chouer (8 ms)
    startAutoBackups
      ÔêÜ devrait g├®rer l'absence de node-cron (51 ms)

FAIL tests/bot-editreply-formdata-empty-content.test.js
  bot.js - editReply avec FormData et embeds (probl├¿me content vide)
    ├ù devrait envoyer un message avec embeds et Zero-Width Space comme content (847 ms)
    ÔêÜ devrait remplacer un espace vide par Zero-Width Space avec des embeds (10 ms)
    ÔêÜ devrait accepter un payload avec embeds et Zero-Width Space comme content (6 ms)

  ÔùÅ bot.js - editReply avec FormData et embeds (probl├¿me content vide) ÔÇ║ devrait envoyer un message avec embeds 
et Zero-Width Space comme content

    EPERM: operation not permitted, open 'C:\Users\anne\Desktop\GLSL_DISCORD\tests\temp-test.gif'

       95 |         // Cr├®er un fichier temporaire pour le test
       96 |         const testFile = path.join(__dirname, 'temp-test.gif');
    >  97 |         fs.writeFileSync(testFile, 'test gif content');
          |            ^
       98 |         
       99 |         try {
      100 |             const embed = new EmbedBuilder()

      at Object.writeFileSync (tests/bot-editreply-formdata-empty-content.test.js:97:12)

FAIL tests/shader-preset-integration.test.js
  shader-preset - Tests d'int├®gration
    Attachement du GIF
      ├ù devrait attacher le GIF quand il existe (chemin absolu) (865 ms)
      ÔêÜ devrait attacher le GIF quand il existe (chemin relatif) (11 ms)
      ÔêÜ devrait attacher le GIF depuis le cache (3 ms)
      ÔêÜ devrait utiliser le fallback (premi├¿re frame) si le GIF n'existe pas (5 ms)
      ÔêÜ ne devrait pas attacher de fichier si ni GIF ni frames ne sont disponibles (1 ms)
      ÔêÜ devrait r├®soudre correctement les chemins relatifs du cache (2 ms)
    Gestion d'erreurs
      ÔêÜ devrait g├®rer les erreurs avec ErrorHandler (2 ms)

  ÔùÅ shader-preset - Tests d'int├®gration ÔÇ║ Attachement du GIF ÔÇ║ devrait attacher le GIF quand il existe (chemin 
absolu)

    EPERM: operation not permitted, open 'C:\Users\anne\Desktop\GLSL_DISCORD\tests\temp-test.gif'

      106 |             // Cr├®er un fichier GIF temporaire
      107 |             const tempGifPath = path.join(__dirname, 'temp-test.gif');
    > 108 |             fs.writeFileSync(tempGifPath, 'fake gif content');
          |                ^
      109 |
      110 |             try {
      111 |                 mockCompiler.compileShader.mockResolvedValue({

      at Object.writeFileSync (tests/shader-preset-integration.test.js:108:16)

PASS tests/shader-cache.test.js
  ShaderCache
    constructor
      ÔêÜ devrait cr├®er un cache avec le r├®pertoire par d├®faut (2 ms)
      ÔêÜ devrait cr├®er le r├®pertoire de cache s'il n'existe pas
    getShaderHash
      ÔêÜ devrait g├®n├®rer un hash SHA256 (1 ms)
      ÔêÜ devrait g├®n├®rer le m├¬me hash pour le m├¬me code
    getCachedGif
      ÔêÜ devrait retourner null si pas de cache (1 ms)
      ÔêÜ devrait retourner le GIF depuis le cache m├®moire si valide (1 ms)
      ÔêÜ devrait supprimer le cache m├®moire si expir├®
      ÔêÜ devrait retourner le GIF depuis le cache disque si valide (1 ms)
      ÔêÜ devrait supprimer le cache disque si expir├®
    setCache
      ÔêÜ devrait mettre en cache un GIF (1 ms)
      ÔêÜ devrait mettre ├á jour le cache m├®moire
    deleteCache
      ÔêÜ devrait supprimer le cache pour un hash
      ÔêÜ devrait supprimer le cache m├®moire
    cleanExpired
      ÔêÜ devrait nettoyer les caches expir├®s (1 ms)
    getStats
      ÔêÜ devrait retourner les statistiques du cache (1 ms)
    getShaderCache singleton
      ÔêÜ devrait retourner la m├¬me instance

PASS tests/utils/abTesting.test.js
  ABTest
    getVariant
      ÔêÜ devrait retourner une variante pour un exp├®rience existante (2 ms)
      ÔêÜ devrait retourner null pour une exp├®rience inexistante
      ÔêÜ devrait retourner la m├¬me variante pour le m├¬me utilisateur (1 ms)
      ÔêÜ devrait retourner diff├®rentes variantes pour diff├®rents utilisateurs
    trackConversion
      ÔêÜ devrait tracker une conversion (1 ms)
      ÔêÜ devrait tracker plusieurs conversions pour le m├¬me utilisateur
      ÔêÜ devrait tracker des m├®triques sp├®cifiques
      ÔêÜ devrait tracker des valeurs personnalis├®es
    getResults
      ÔêÜ devrait retourner les r├®sultats pour toutes les variantes (1 ms)
      ÔêÜ devrait calculer le taux de conversion (1 ms)
      ÔêÜ devrait retourner null pour une exp├®rience inexistante
      ÔêÜ devrait retourner des r├®sultats vides pour une exp├®rience sans conversions
    hashUserId
      ÔêÜ devrait retourner un hash entre 0 et 99 (1 ms)
      ÔêÜ devrait retourner le m├¬me hash pour le m├¬me userId
      ÔêÜ devrait retourner des hash diff├®rents pour des userId diff├®rents (1 ms)
    createExperiment
      ÔêÜ devrait cr├®er une nouvelle exp├®rience
      ÔêÜ devrait rejeter si variants et weights ont des longueurs diff├®rentes (19 ms)
      ÔêÜ devrait rejeter si les weights ne somment pas ├á 100 (1 ms)
      ÔêÜ devrait accepter des weights qui somment approximativement ├á 100
    getAllExperiments
      ÔêÜ devrait retourner toutes les exp├®riences
    getVariant - edge cases
      ÔêÜ devrait retourner la premi├¿re variante si hash d├®passe les weights (1 ms)
      ÔêÜ devrait g├®rer les hash aux limites des weights (3 ms)
    trackConversion - edge cases
      ÔêÜ devrait tracker des conversions avec valeur 0
      ÔêÜ devrait tracker des conversions avec valeurs n├®gatives
      ÔêÜ devrait tracker plusieurs m├®triques diff├®rentes
    getResults - edge cases
      ÔêÜ devrait calculer avgValue correctement avec conversions multiples (1 ms)
      ÔêÜ devrait retourner avgValue 0 si pas de conversions (1 ms)
      ÔêÜ devrait g├®rer les variantes sans r├®sultats
    createExperiment - edge cases
      ÔêÜ devrait accepter une description vide
      ÔêÜ devrait accepter des weights avec d├®cimales
      ÔêÜ devrait rejeter si la somme des weights est trop ├®loign├®e de 100 (1 ms)
    hashUserId - edge cases
      ÔêÜ devrait g├®rer les userId vides
      ÔêÜ devrait g├®rer les userId num├®riques
      ÔêÜ devrait g├®rer les userId avec caract├¿res sp├®ciaux
    getABTest singleton
      ÔêÜ devrait retourner la m├¬me instance

PASS tests/utils/embedBuilder.test.js
  CustomEmbedBuilder
    success
      ÔêÜ devrait cr├®er un embed de succ├¿s (7 ms)
      ÔêÜ devrait cr├®er un embed de succ├¿s avec des fields (1 ms)
      ÔêÜ devrait cr├®er un embed de succ├¿s sans fields
    error
      ÔêÜ devrait cr├®er un embed d'erreur (1 ms)
    info
      ÔêÜ devrait cr├®er un embed d'information (1 ms)
      ÔêÜ devrait cr├®er un embed d'information avec des fields
    warning
      ÔêÜ devrait cr├®er un embed d'avertissement (1 ms)
    shaderCompiled
      ÔêÜ devrait cr├®er un embed pour shader compil├® avec toutes les donn├®es (1 ms)
      ÔêÜ devrait cr├®er un embed avec donn├®es minimales
      ÔêÜ devrait inclure le cache si pr├®sent (1 ms)
    progress
      ÔêÜ devrait cr├®er un embed de progression
    createProgressBar
      ÔêÜ devrait cr├®er une barre de progression (1 ms)
      ÔêÜ devrait cr├®er une barre de progression ├á 0%
      ÔêÜ devrait cr├®er une barre de progression ├á 100%
    stats
      ÔêÜ devrait cr├®er un embed de statistiques (1 ms)
      ÔêÜ devrait cr├®er un embed avec statistiques partielles

PASS tests/commands.test.js
  Commandes Discord
    shader-preset
      ÔêÜ devrait avoir les options requises (908 ms)
    shader
      ÔêÜ devrait avoir les options requises (10 ms)
      ÔêÜ devrait avoir des options de texture optionnelles

PASS tests/utils/featureFlags.test.js
  FeatureFlags
    isEnabled
      ÔêÜ devrait retourner true pour un flag activ├® ├á 100% (2 ms)
      ÔêÜ devrait retourner false pour un flag d├®sactiv├®
      ÔêÜ devrait retourner false pour un flag inexistant (1 ms)
      ÔêÜ devrait retourner true pour un rollout ├á 100% avec userId
      ÔêÜ devrait retourner false pour un rollout ├á 0%
      ÔêÜ devrait utiliser le hash userId pour un rollout partiel (1 ms)
      ÔêÜ devrait g├®rer un rollout partiel correctement (1 ms)
      ÔêÜ devrait retourner false si enabled est false m├¬me avec rollout 100
      ÔêÜ devrait utiliser un pourcentage al├®atoire sans userId (1 ms)
    hashUserId
      ÔêÜ devrait retourner un hash entre 0 et 99
      ÔêÜ devrait retourner le m├¬me hash pour le m├¬me userId (1 ms)
    setFlag
      ÔêÜ devrait cr├®er un nouveau flag
      ÔêÜ devrait mettre ├á jour un flag existant
      ÔêÜ devrait pr├®server la description existante si non fournie
      ÔêÜ devrait limiter le rollout entre 0 et 100
    getAllFlags
      ÔêÜ devrait retourner tous les flags (1 ms)
    getFlag
      ÔêÜ devrait retourner un flag existant
      ÔêÜ devrait retourner null pour un flag inexistant
    loadFromEnv
      ÔêÜ devrait charger les flags depuis les variables d'environnement (2 ms)
      ÔêÜ devrait g├®rer les flags avec seulement enabled
      ÔêÜ devrait g├®rer les flags d├®sactiv├®s (1 ms)
      ÔêÜ devrait convertir les noms avec underscores et majuscules (1 ms)
    getFeatureFlags singleton
      ÔêÜ devrait retourner la m├¬me instance (3 ms)

PASS tests/utils/errorHandler.test.js
  ErrorHandler
    handle
      ÔêÜ devrait g├®rer une erreur et r├®pondre ├á l'interaction (9 ms)
      ÔêÜ devrait utiliser followUp si interaction d├®j├á r├®pondue (1 ms)
      ÔêÜ devrait utiliser followUp si interaction d├®j├á diff├®r├®e (1 ms)
      ÔêÜ devrait g├®rer les erreurs lors de l'envoi du message
      ÔêÜ devrait inclure le contexte dans les logs (1 ms)
    getErrorMessage
      ÔêÜ devrait retourner un message pour timeout
      ÔêÜ devrait retourner un message pour syntax error (1 ms)
      ÔêÜ devrait retourner un message pour WebGL error
      ÔêÜ devrait retourner un message pour memory error (1 ms)
      ÔêÜ devrait retourner un message pour not found
      ÔêÜ devrait retourner un message pour rate limit (1 ms)
      ÔêÜ devrait retourner un message g├®n├®rique pour autres erreurs
      ÔêÜ devrait g├®rer les erreurs sans message
    log
      ÔêÜ devrait logger une erreur sans r├®pondre (1 ms)
      ÔêÜ devrait logger sans contexte

PASS tests/utils/logger.test.js
  Logger
    formatTimestamp
      ÔêÜ devrait formater un timestamp ISO (2 ms)
    info
      ÔêÜ devrait logger un message info (1 ms)
      ÔêÜ devrait logger avec des arguments suppl├®mentaires
    error
      ÔêÜ devrait logger une erreur sans stack (1 ms)
      ÔêÜ devrait logger une erreur avec stack (8 ms)
      ÔêÜ devrait logger une erreur sans objet error
      ÔêÜ devrait logger avec des arguments suppl├®mentaires (1 ms)
    warn
      ÔêÜ devrait logger un avertissement (1 ms)
    debug
      ÔêÜ ne devrait pas logger si DEBUG n'est pas activ├®
      ÔêÜ devrait logger si DEBUG est activ├® (1 ms)
    success
      ÔêÜ devrait logger un message de succ├¿s

PASS tests/bot-editreply-formdata.test.js
  bot.js - editReply avec FormData
    ÔêÜ devrait cr├®er un payload JSON valide avec embeds (8 ms)
    ÔêÜ devrait ajouter un contenu par d├®faut si le payload est vide (1 ms)
    ÔêÜ devrait d├®tecter un payload vide avant l'envoi
    ÔêÜ devrait valider que le payload contient au moins content ou embeds (1 ms)
    ÔêÜ devrait utiliser fetch avec le token Discord pour FormData (3 ms)
    ÔêÜ devrait g├®rer les erreurs Discord API correctement (1 ms)
    ÔêÜ devrait valider le payload JSON avant l'envoi avec FormData
    ÔêÜ devrait supprimer un content qui est juste un espace avec des embeds (1 ms)
    ÔêÜ devrait d├®tecter et corriger un payload vide avant l'envoi

PASS tests/utils/rateLimiter.test.js
  RateLimiter
    checkLimit
      ÔêÜ devrait autoriser une requ├¬te valide (2 ms)
      ÔêÜ devrait bloquer si limite utilisateur d├®pass├®e
      ÔêÜ devrait bloquer si limite globale d├®pass├®e
      ÔêÜ devrait r├®initialiser la limite globale si expir├®e
      ÔêÜ devrait r├®initialiser la limite utilisateur si expir├®e
      ÔêÜ devrait incr├®menter le compteur global (1 ms)
    getCommandLimit
      ÔêÜ devrait retourner la limite pour une commande connue (1 ms)
      ÔêÜ devrait retourner la limite par d├®faut pour une commande inconnue
    getStats
      ÔêÜ devrait retourner les statistiques (1 ms)
    resetUser
      ÔêÜ devrait r├®initialiser les limites pour un utilisateur et une commande (1 ms)
      ÔêÜ devrait r├®initialiser toutes les limites d'un utilisateur si commande non sp├®cifi├®e
    startCleanup
      ÔêÜ devrait d├®marrer le nettoyage automatique (2 ms)
    getRateLimiter singleton
      ÔêÜ devrait retourner la m├¬me instance (1 ms)

PASS tests/bot-editreply-zerowidth-space.test.js
  bot.js - editReply avec Zero-Width Space et FormData
    ÔêÜ devrait utiliser Zero-Width Space (ÔÇï) quand pas de content avec FormData + embeds (866 ms)
    ÔêÜ devrait utiliser Zero-Width Space m├¬me si content est un espace vide (4 ms)
    ÔêÜ devrait utiliser le content r├®el si fourni avec FormData + embeds (1 ms)
    ÔêÜ devrait valider que Zero-Width Space n'est pas trimm├® (1 ms)
    ÔêÜ devrait utiliser Zero-Width Space avec FormData m├¬me sans embeds (2 ms)
    ÔêÜ ne devrait pas utiliser Zero-Width Space si content r├®el est fourni
    ÔêÜ devrait g├®rer correctement les erreurs Discord API avec Zero-Width Space (14 ms)

PASS tests/utils/healthCheck.test.js
  HealthCheck
    checkHealth
      ÔêÜ devrait retourner un rapport de sant├® complet (15 ms)
      ÔêÜ devrait v├®rifier la base de donn├®es si fournie (37 ms)
      ÔêÜ devrait v├®rifier le browser pool si fourni (25 ms)
      ÔêÜ devrait v├®rifier l'espace disque (1 ms)
      ÔêÜ devrait v├®rifier la m├®moire (1 ms)
      ÔêÜ devrait g├®rer les d├®pendances manquantes
      ÔêÜ devrait marquer comme degraded si certaines v├®rifications ├®chouent (1 ms)
      ÔêÜ devrait inclure les informations de version (1 ms)
      ÔêÜ devrait inclure l'uptime
      ÔêÜ devrait v├®rifier le cache si fourni (1 ms)
      ÔêÜ devrait v├®rifier le bot si fourni (1 ms)
      ÔêÜ devrait g├®rer les erreurs de v├®rification individuellement (1 ms)
      ÔêÜ devrait marquer comme warning si le browser pool est plein (531 ms)

PASS tests/bot-editreply-empty-content-fix.test.js
  bot.js - Correction content vide avec FormData
    ÔêÜ devrait supprimer un content qui est juste un espace si on a des embeds (2 ms)
    ÔêÜ devrait remplacer un content vide par un contenu par d├®faut si pas d'embeds
    ÔêÜ ne devrait pas modifier un content valide (1 ms)
    ÔêÜ devrait valider que le payload final n'a pas de content vide
    ÔêÜ devrait cr├®er un payload JSON valide sans content vide (1 ms)

PASS tests/http-interaction-files.test.js
  HTTP Interaction - Envoi de fichiers
    ÔêÜ devrait envoyer un fichier GIF via FormData (13 ms)
    ÔêÜ devrait d├®tecter si AttachmentBuilder n'expose pas le fichier correctement (2 ms)
    ÔêÜ devrait ├®chouer si le fichier ne peut pas ├¬tre lu depuis AttachmentBuilder (3 ms)
    ÔêÜ devrait ajouter un contenu par d├®faut si le payload JSON est vide (2 ms)
    ÔêÜ devrait valider que le payload_json contient au moins content ou embeds (10 ms)

PASS tests/utils/prometheus.test.js
  PrometheusMetrics
    recordCompilation
      ÔêÜ devrait enregistrer une compilation r├®ussie (2 ms)
      ÔêÜ devrait enregistrer une compilation ├®chou├®e
      ÔêÜ devrait enregistrer la dur├®e (1 ms)
      ÔêÜ devrait limiter ├á 100 dur├®es
    updateBrowserPool
      ÔêÜ devrait mettre ├á jour les m├®triques du browser pool (1 ms)
    recordCacheHit/Miss
      ÔêÜ devrait enregistrer un cache hit
      ÔêÜ devrait enregistrer un cache miss (1 ms)
    updateQueueLength
      ÔêÜ devrait mettre ├á jour la longueur de la queue
    recordRateLimitHit
      ÔêÜ devrait enregistrer un rate limit hit (1 ms)
    getAverageDuration
      ÔêÜ devrait retourner 0 si aucune dur├®e
      ÔêÜ devrait calculer la moyenne
    getPrometheusFormat
      ÔêÜ devrait g├®n├®rer le format Prometheus (1 ms)
      ÔêÜ devrait calculer le taux de r├®ussite
    getPrometheusMetrics singleton
      ÔêÜ devrait retourner la m├¬me instance

PASS tests/http-payload-validation.test.js
  HTTP Interaction - Validation du Payload JSON
    ÔêÜ devrait d├®tecter un payload JSON vide (2 ms)
    ÔêÜ devrait construire un payload valide avec embeds
    ÔêÜ devrait ajouter un contenu par d├®faut si le payload est vide (1 ms)
    ÔêÜ devrait valider que Discord n├®cessite au moins content ou embeds

PASS tests/utils/jsEscape.test.js
  jsEscape
    escapeJSString
      ÔêÜ devrait ├®chapper une cha├«ne simple (2 ms)
      ÔêÜ devrait ├®chapper les guillemets
      ÔêÜ devrait ├®chapper les apostrophes (2 ms)
      ÔêÜ devrait ├®chapper les retours ├á la ligne
      ÔêÜ devrait convertir les non-strings en strings (1 ms)
      ÔêÜ devrait ├®chapper les caract├¿res sp├®ciaux
    escapeJSStringForTemplate
      ÔêÜ devrait ├®chapper avec guillemets
      ÔêÜ devrait ├®chapper les caract├¿res sp├®ciaux
      ÔêÜ devrait convertir les non-strings
    normalizeAccents
      ÔêÜ devrait normaliser les accents fran├ºais (1 ms)
      ÔêÜ devrait normaliser tous les accents
      ÔêÜ devrait laisser les caract├¿res sans accents inchang├®s
      ÔêÜ devrait convertir les non-strings
    escapeForConsoleLog
      ÔêÜ devrait ├®chapper pour console.log (1 ms)
      ÔêÜ devrait normaliser les accents si demand├®
      ÔêÜ ne devrait pas normaliser les accents par d├®faut
      ÔêÜ devrait ├®chapper les caract├¿res sp├®ciaux

PASS tests/utils/shaderValidator.test.js
  ShaderValidator
    validate
      ÔêÜ devrait accepter un shader GLSL valide (2 ms)
      ÔêÜ devrait rejeter un shader sans mainImage (1 ms)
      ÔêÜ devrait d├®tecter les boucles infinies (1 ms)
      ÔêÜ devrait d├®tecter les instructions dangereuses (1 ms)
      ÔêÜ devrait rejeter un code trop long (1 ms)
    sanitize
      ÔêÜ devrait enlever les commentaires
      ÔêÜ devrait normaliser les espaces (1 ms)
    validateAndSanitize
      ÔêÜ devrait valider et nettoyer en une op├®ration

(node:32160) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGTERM listeners added to 
[process]. Use emitter.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
(node:32160) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGINT listeners added to 
[process]. Use emitter.setMaxListeners() to increase limit
(node:32160) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 uncaughtException listeners 
added to [process]. Use emitter.setMaxListeners() to increase limit
(node:32160) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 unhandledRejection listeners 
added to [process]. Use emitter.setMaxListeners() to increase limit
PASS tests/commands/shader-generate.test.js
  shader-generate command
    ÔêÜ devrait avoir la structure de commande correcte (6 ms)
    ÔêÜ devrait g├®n├®rer un shader avec succ├¿s (2 ms)
    ÔêÜ devrait rejeter si g├®n├®ration ├®choue (1 ms)
    ÔêÜ devrait rejeter si validation ├®choue
    ÔêÜ devrait g├®rer les erreurs de compilation (1 ms)
    ÔêÜ devrait utiliser les valeurs par d├®faut pour speed et size
    ÔêÜ devrait g├®rer les erreurs (1 ms)
    ÔêÜ devrait utiliser le chemin absolu pour le GIF si disponible (1 ms)
    ÔêÜ devrait utiliser le chemin original si le chemin absolu n'existe pas (1 ms)
    ÔêÜ devrait utiliser la premi├¿re frame si le GIF n'existe pas
    ÔêÜ devrait g├®rer le cas o├╣ ni GIF ni frames ne sont disponibles (1 ms)
    ÔêÜ devrait g├®rer les erreurs de database.saveShader (1 ms)
    ÔêÜ devrait g├®rer les erreurs de database.updateUserStats
    ÔêÜ devrait g├®rer les erreurs de compilation avec try-catch
    ÔêÜ devrait utiliser diff├®rentes valeurs de speed (1 ms)
    ÔêÜ devrait utiliser diff├®rentes valeurs de size (1 ms)

PASS tests/commands/help.test.js
  help command
    ÔêÜ devrait avoir la structure de commande correcte (7 ms)
    ÔêÜ devrait ex├®cuter la commande help avec succ├¿s (3 ms)
    ÔêÜ devrait g├®rer les erreurs

PASS tests/commands/shader-code.test.js
  shader-code command
    ÔêÜ devrait avoir la structure de commande correcte (4 ms)
    autocomplete
      ÔêÜ devrait retourner des suggestions filtr├®es (1 ms)
      ÔêÜ devrait filtrer par pr├®fixe (1 ms)
      ÔêÜ devrait limiter ├á 25 r├®sultats
    execute
      ÔêÜ devrait afficher le code du shader si trouv├® (1 ms)
      ÔêÜ devrait afficher un message d'erreur si shader non trouv├®
      ÔêÜ devrait diviser le code en plusieurs messages si trop long
      ÔêÜ devrait g├®rer les erreurs

PASS tests/commands/admin.test.js
  admin command
    ÔêÜ devrait avoir la structure de commande correcte (5 ms)
    ÔêÜ devrait rejeter les non-admins (1 ms)
    stats subcommand
      ÔêÜ devrait afficher les statistiques (2 ms)
      ÔêÜ devrait appeler toutes les m├®thodes getStats (1 ms)
    cleanup subcommand
      ÔêÜ devrait nettoyer le cache
    restart-pool subcommand
      ÔêÜ devrait red├®marrer le pool (3 ms)
    reset-rate-limit subcommand
      ÔêÜ devrait r├®initialiser les rate limits d'un utilisateur
      ÔêÜ devrait r├®initialiser tous les rate limits si aucun utilisateur sp├®cifi├® (1 ms)
    cache-stats subcommand
      ÔêÜ devrait afficher les statistiques du cache (1 ms)
    sous-commande inconnue
      ÔêÜ devrait afficher une erreur pour une sous-commande inconnue (1 ms)
    gestion d'erreurs
      ÔêÜ devrait g├®rer les erreurs (1 ms)

  ÔùÅ  process.exit called with "0"

      82 |
      83 |         Logger.info('Ô£à Graceful shutdown completed');
    > 84 |         process.exit(0);
         |                 ^
      85 |     }
      86 |
      87 |     /**

      at GracefulShutdown.exit [as shutdown] (src/utils/gracefulShutdown.js:84:17)
FAIL tests/utils/gracefulShutdown.test.js
  ÔùÅ Test suite failed to run

    A jest worker process (pid=32160) crashed for an unknown reason: exitCode=0

      at ChildProcessWorker._onExit (node_modules/jest-worker/build/workers/ChildProcessWorker.js:370:23)

PASS tests/commands-complete.test.js
  Commandes Discord - Tests Complets
    /help
      ÔêÜ devrait avoir la structure correcte (35 ms)
      ÔêÜ devrait avoir une fonction execute (1 ms)
    /shader
      ÔêÜ devrait avoir la structure correcte (20 ms)
      ÔêÜ devrait avoir l'option code requise (1 ms)
      ÔêÜ devrait avoir des options de texture optionnelles
      ÔêÜ devrait avoir l'option name optionnelle
      ÔêÜ devrait avoir une fonction execute
    /shader-preset
      ÔêÜ devrait avoir la structure correcte (7 ms)
      ÔêÜ devrait avoir l'option preset requise avec autocomplete
      ÔêÜ devrait avoir une fonction execute (1 ms)
      ÔêÜ devrait avoir une fonction autocomplete
      ÔêÜ devrait avoir la liste des presets dans le code (1 ms)
    /shader-generate
      ÔêÜ devrait avoir la structure correcte (9 ms)
      ÔêÜ devrait avoir l'option shape requise avec choix (1 ms)
      ÔêÜ devrait avoir l'option color requise avec choix (1 ms)
      ÔêÜ devrait avoir l'option animation requise avec choix
      ÔêÜ devrait avoir l'option speed optionnelle avec choix (1 ms)
      ÔêÜ devrait avoir l'option size optionnelle avec limites (1 ms)
      ÔêÜ devrait avoir une fonction execute
    /shader-code
      ÔêÜ devrait avoir la structure correcte (7 ms)
      ÔêÜ devrait avoir l'option name requise avec autocomplete
      ÔêÜ devrait avoir une fonction execute (1 ms)
      ÔêÜ devrait avoir une fonction autocomplete
    /admin
      ÔêÜ devrait avoir la structure correcte (221 ms)
      ÔêÜ devrait avoir la sous-commande stats
      ÔêÜ devrait avoir la sous-commande cleanup
      ÔêÜ devrait avoir la sous-commande restart-pool
      ÔêÜ devrait avoir la sous-commande reset-rate-limit avec option user (1 ms)
      ÔêÜ devrait avoir la sous-commande cache-stats
      ÔêÜ devrait avoir une fonction execute
      ÔêÜ devrait avoir toutes les fonctions de gestion des sous-commandes (1 ms)
    Validation des commandes
      ÔêÜ toutes les commandes devraient avoir un nom valide (1 ms)
      ÔêÜ toutes les commandes devraient avoir une description (1 ms)
      ÔêÜ toutes les commandes devraient avoir une fonction execute (1 ms)
    Validation des options
      ÔêÜ les options requises devraient ├¬tre marqu├®es comme telles
      ÔêÜ les options optionnelles devraient ├¬tre marqu├®es comme telles

PASS tests/commands/shader.test.js
  shader command
    ÔêÜ devrait avoir la structure de commande correcte (4 ms)
    ÔêÜ devrait rejeter si rate limit d├®pass├® (1 ms)
    ÔêÜ devrait rejeter un code vide (1 ms)
    ÔêÜ devrait rejeter un code invalide
    ÔêÜ devrait compiler un shader valide (1 ms)
    ÔêÜ devrait g├®rer les erreurs de compilation
    ÔêÜ devrait g├®rer les erreurs
    ÔêÜ devrait g├®rer les textures optionnelles (1 ms)
    ÔêÜ devrait filtrer les textures null
    ÔêÜ devrait utiliser le code sanitized si disponible (1 ms)
    ÔêÜ devrait utiliser le code original si sanitized n'est pas disponible (1 ms)
    ÔêÜ devrait g├®rer le cas o├╣ aucune texture n'est fournie
    ÔêÜ devrait sauvegarder le shader avec le nom optionnel (1 ms)
    ÔêÜ devrait sauvegarder le shader sans nom si non fourni
    ÔêÜ devrait g├®rer les erreurs de database.saveShader
    ÔêÜ devrait g├®rer les erreurs de database.updateUserStats
    ÔêÜ devrait utiliser le chemin absolu pour le GIF si disponible (1 ms)
    ÔêÜ devrait utiliser le chemin original si le chemin absolu n'existe pas
    ÔêÜ devrait utiliser la premi├¿re frame si le GIF n'existe pas (1 ms)
    ÔêÜ devrait d├®finir le footer avec le nom si fourni
    ÔêÜ devrait d├®finir le footer sans nom si non fourni (1 ms)
    ÔêÜ devrait g├®rer le cas o├╣ ni GIF ni frames ne sont disponibles
    ÔêÜ devrait g├®rer le cas o├╣ le code est null
    ÔêÜ devrait g├®rer le cas o├╣ le code est seulement des espaces (1 ms)

PASS tests/utils/gifOptimizer.test.js (5.982 s)
  GIFOptimizer
    detectOptimalQuality
      ÔêÜ devrait retourner une qualit├® par d├®faut pour des frames vides (8 ms)
      ÔêÜ devrait retourner une qualit├® basse pour des frames simples (4 ms)
      ÔêÜ devrait g├®rer les erreurs gracieusement (1 ms)
    countUniqueColors
      ÔêÜ devrait compter les couleurs uniques
      ÔêÜ devrait retourner une valeur par d├®faut en cas d'erreur (1 ms)
      ÔêÜ devrait ├®chantillonner pour les grandes frames (1 ms)
    optimizeFrame
      ÔêÜ devrait retourner la frame originale si sharp n'est pas disponible (29 ms)
      ÔêÜ devrait retourner la frame originale si pas de redimensionnement n├®cessaire (3 ms)
      ÔêÜ devrait g├®rer les erreurs gracieusement (3 ms)
    getQualityValue
      ÔêÜ devrait retourner les valeurs de qualit├® correctes (1 ms)
      ÔêÜ devrait retourner 10 par d├®faut pour une qualit├® inconnue
    createOptimizedGIF
      ÔêÜ devrait cr├®er un GIF optimis├® (203 ms)
      ÔêÜ devrait utiliser la qualit├® auto si sp├®cifi├®e (180 ms)
      ÔêÜ devrait utiliser les options par d├®faut (4660 ms)
    estimateOptimalSize
      ÔêÜ devrait estimer la taille optimale (1 ms)
      ÔêÜ devrait retourner une taille par d├®faut en cas d'erreur
      ÔêÜ devrait adapter la taille selon la complexit├® (7 ms)
    detectOptimalQuality - diff├®rents seuils de couleurs
      ÔêÜ devrait retourner qualit├® 1 pour moins de 64 couleurs (1 ms)
      ÔêÜ devrait retourner qualit├® 5 pour 64-127 couleurs (2 ms)
      ÔêÜ devrait retourner qualit├® 10 pour 128-255 couleurs (3 ms)
      ÔêÜ devrait retourner qualit├® 20 pour plus de 256 couleurs (1 ms)
    countUniqueColors - cas limites
      ÔêÜ devrait g├®rer une frame tr├¿s petite
      ÔêÜ devrait ├®chantillonner correctement les grandes frames (1 ms)
      ÔêÜ devrait g├®rer une frame avec moins de 4 bytes
    optimizeFrame - redimensionnement
      ÔêÜ devrait retourner la frame originale si pas de targetWidth/Height (2 ms)
      ÔêÜ devrait retourner la frame originale si dimensions identiques (1 ms)
    createOptimizedGIF - options et erreurs
      ÔêÜ devrait utiliser optimize=false si sp├®cifi├® (103 ms)
      ÔêÜ devrait utiliser delay personnalis├® (93 ms)
      ÔêÜ devrait g├®rer les erreurs de cr├®ation de GIF (12 ms)
    estimateOptimalSize - diff├®rents seuils
      ÔêÜ devrait retourner 50% pour moins de 64 couleurs (2 ms)
      ÔêÜ devrait retourner 75% pour 64-127 couleurs (3 ms)
      ÔêÜ devrait retourner 100% pour 128+ couleurs (1 ms)

PASS tests/shader-queue.test.js (8.906 s)
  ShaderQueue
    add
      ÔêÜ devrait ajouter un job ├á la queue (9 ms)
      ÔêÜ devrait respecter les priorit├®s (1 ms)
      ÔêÜ devrait utiliser la priorit├® normale par d├®faut
    getPriorityValue
      ÔêÜ devrait retourner la valeur de priorit├® correcte (1 ms)
      ÔêÜ devrait retourner normal pour une priorit├® inconnue
    processQueue
      ÔêÜ devrait traiter les jobs dans l'ordre de priorit├® (1 ms)
      ÔêÜ ne devrait pas d├®passer maxConcurrent (176 ms)
    executeJob
      ÔêÜ devrait ex├®cuter un job avec succ├¿s
      ÔêÜ devrait rejeter si compiler manque (21 ms)
      ÔêÜ devrait rejeter si shaderCode manque (1 ms)
    calculateBackoff
      ÔêÜ devrait calculer le backoff exponentiel
      ÔêÜ devrait calculer le backoff fixe (1 ms)
      ÔêÜ devrait utiliser la valeur par d├®faut pour un type inconnu
    calculateAvgWaitTime
      ÔêÜ devrait retourner 0 pour une queue vide
      ÔêÜ devrait calculer le temps d'attente moyen (21 ms)
    getStats
      ÔêÜ devrait retourner les statistiques (2 ms)
      ÔêÜ devrait mettre ├á jour les stats apr├¿s traitement
    getStatus
      ÔêÜ devrait retourner le statut de la queue (1 ms)
    clear
      ÔêÜ devrait vider la queue
    getJob
      ÔêÜ devrait retourner null pour un job inexistant (1 ms)
    retry logic
      ÔêÜ devrait r├®essayer un job en ├®chec (4012 ms)
      ÔêÜ devrait ├®chouer d├®finitivement apr├¿s maxAttempts (4008 ms)
    getShaderQueue singleton
      ÔêÜ devrait retourner la m├¬me instance (1 ms)

