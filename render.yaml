services:
  - type: web
    name: glsl-discord-bot
    env: node
    plan: free
    # Build optimisé : utilise le cache Render et évite réinstallation Chrome si présent
    buildCommand: chmod +x scripts/render-build.sh && ./scripts/render-build.sh
    # Alternative Docker (plus rapide mais nécessite plan payant) :
    # dockerfilePath: ./Dockerfile
    startCommand: npm run bot
    healthCheckPath: /health
    envVars:
      - key: DISCORD_TOKEN
        sync: false
      - key: DISCORD_CLIENT_ID
        sync: false
      - key: WEBGL_CANVAS_WIDTH
        value: 800
      - key: WEBGL_CANVAS_HEIGHT
        value: 600
      - key: WEBGL_FRAME_RATE
        value: 30
      - key: WEBGL_DURATION
        value: 3
      - key: DATABASE_PATH
        value: ./data/shaders.db
      - key: PUPPETEER_TIMEOUT
        value: 30000
      - key: PUPPETEER_HEADLESS
        value: true
      - key: MAX_SHADER_LENGTH
        value: 10000
      - key: MAX_COMPILATION_TIME
        value: 30000
      - key: LOG_LEVEL
        value: info

